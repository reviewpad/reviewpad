api-version: reviewpad.com/v3.x

mode: silent
edition: professional

labels:
  stale-pr-label:
    name: stale
    description: Stale pull request
    color: "294b69"

rules:
  - name: labeled-as-stale-pr
    kind: patch
    description: Pull request has stale label
    spec: '$isElementOf("stale", $labels())'

  - name: is-stale
    kind: patch
    description: Pull request is stale
    spec: '!$rule("labeled-as-stale-pr") && $lastEventAt() < 30 days ago'

  - name: stale-pr-should-be-closed
    kind: patch
    description: Stale pull request can be closed
    spec: '$rule("labeled-as-stale-pr") && $lastEventAt() < 7 days ago'

workflows:
  - name: check-stale-pr
    if:
      - rule: is-stale
    then:
      - '$info("This pull request is stale.")'
      - '$addLabel("stale-pr-label")'

  - name: close-stale-pr
    if:
      - rule: stale-pr-should-be-closed
    then:
      - '$info("Closing for inactivity.")'
      - '$close()'
